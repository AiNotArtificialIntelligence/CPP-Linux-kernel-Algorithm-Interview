# 深入理解linux内核

# 当前进度： 37 页

## 一章

大部分操作系统都可以动态的加载和卸载部分内核代码，比如设备驱动程序，这些内核代码称为模块



一旦一个进程获得大内核锁，进入了被它保护的临界区，不但该临界区被锁住，所有被它保护的其它临界区都将无法访问，直到该进程释放大内核锁。这看似不可思议：一个进程在一个处理器上操作一个全局的链表，怎么可能导致其它进程无法访问另一个全局数组呢？使用两个自旋锁，一个保护链表，另一个保护数组不就解决了吗？可是如果你使用大内核锁，效果就是这样的，，，大内核锁，只要一个处理器陷入内核态，就会获得大内核锁，锁住内核？



Unix每个进程都有一个当前工作目录，属于进程执行上下文，标识出进程所用的当前目录

### 软硬链接

链接简单来说是一种文件共享的方式，是POSIX中的概念，可以将链接简单的理解为Win中的快捷方式，Linux中常用来解决一些**库版本**的问题，通常也会将一些目录层次较深的文件链接到一个更易访问的目录中

包含在目录中的文件名是硬链接，使用ln命令创建硬链接，，，，限制：不允许用户给目录创建硬链接、只有同一文件系统中的文件之间才能创建链接，，为了解决这些限制，引入了软链接，使用ln -s命令

硬链接具有相同的inode节点，创建硬链接就相当于在inode上增加引用计数，，软链接是不同的inode，它保存了它代表的文件的绝对路径

### 文件类型

```
普通文件
目录
符号链接
面向块的设备文件
面向字符的设备文件
管道和命名管道
套接字
```

前三种是所有Unix文件系统的基本类型

设备文件与I/O设备以及集成到内核中的设备驱动程序有关，例如当程序访问某个设备文件时，它直接访问与那个文件相关的I/O设备

管道和套接字是用于进程间通信的特殊文件



文件系统使用索引节点（inode）来标识文件，文件系统处理文件需要的所有信息包含在一个inode中



当用户访问一个普通文件或者目录文件的内容时，他实际上是访问**存储在硬件块设备上的一些数据**，。从这个意义上说，文件系统是硬盘分区物理组织的用户级视图，因为处于用户态的进程不能直接和底层硬件交互，所以每个实际的文件操作必须在**内核态**下进行



文件描述符标识进程与打开文件之间的交互，而打开文件对象包含了这种交互相关的数据（进行的操作之类的？和文件指针等）



普通Unix文件可以顺序访问也可以随机访问，对于**设备文件和命名管道文件**，通常只能**顺序**访问

### 进程描述符

进程切换时，把一些重要寄存器（现场）保存在进程描述符（task_struct）中



对一个变量进行同步的话，可以直接使用原子操作，但是内核大多数的数据结构并不是简单的一个变量，是临界区



非抢占式内核，当进程在内核态执行时不能被抢占的，

抢占式内核，在应用同步机制时，确保进入临界区之前禁止抢占，退出时启用抢占



自旋锁在单处理器环境下无效



信号是把**系统事件**报告给**进程**的一种机制
